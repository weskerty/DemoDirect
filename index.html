<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paraguay Libre</title>
    <link rel="icon" type="image/x-icon" href="web/favicon.ico">
    <link rel="stylesheet" href="web/estilo.css">
    <meta name="description" content="Por un Paraguay Mejor, Libre de Corrupción.">
    <meta property="og:image" content="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Sun%20with%20Face.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/13.0.1/markdown-it.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it-anchor@8.6.7/dist/markdownItAnchor.umd.min.js"></script>
</head>
<body>
    <div class="loading-screen" id="loading-screen">
        <p>⌛Cargando⏳</p>
    </div>

<video autoplay muted loop id="bg-video" preload="auto" >
    <source src="" type="video/mp4">
</video>

    <div class="content" id="content">
        <p>⌛Cargando⏳</p>
    </div>

    <div id="disqus-container"></div>
    
    <script>
 const monthlyVideos = {
    0: 'https://videos.pexels.com/video-files/5834608/5834608-hd_1280_720_25fps.mp4',
    1: 'https://videos.pexels.com/video-files/8279906/8279906-hd_1280_720_24fps.mp4',
    2: 'https://github.com/user-attachments/assets/330277fb-be36-46c2-910b-6b8c1aabe942',
    3: 'https://github.com/user-attachments/assets/330277fb-be36-46c2-910b-6b8c1aabe942',
    4: 'https://github.com/user-attachments/assets/330277fb-be36-46c2-910b-6b8c1aabe942',
    5: 'https://github.com/user-attachments/assets/330277fb-be36-46c2-910b-6b8c1aabe942',
    6: 'https://github.com/user-attachments/assets/330277fb-be36-46c2-910b-6b8c1aabe942',
    7: 'https://videos.pexels.com/video-files/6157145/6157145-hd_1366_720_25fps.mp4',
    8: 'https://github.com/user-attachments/assets/330277fb-be36-46c2-910b-6b8c1aabe942',
    9: 'https://github.com/user-attachments/assets/330277fb-be36-46c2-910b-6b8c1aabe942',
    10: 'https://videos.pexels.com/video-files/4957757/4957757-hd_1280_720_50fps.mp4',
    11: 'https://github.com/user-attachments/assets/b746d91d-55ae-4679-add6-fcf71e05dcd4'
};

const DEFAULT_PAGE = 'web/es.html';
let currentPage = '';
let isOnMainPage = true;

const md = window.markdownit({
    html: true,        
    breaks: true,     
    linkify: true,     
    typographer: true  
}).use(window.markdownItAnchor, {
    permalink: window.markdownItAnchor.permalink.headerLink()
});

function isMobile() {
    return window.matchMedia("(max-width: 768px)").matches;
}

function getCurrentMonthVideo() {
    const currentMonth = new Date().getMonth();
    return monthlyVideos[currentMonth];
}

function hideLoadingScreen() {
    const loadingScreen = document.getElementById('loading-screen');
    if (loadingScreen) {
        loadingScreen.classList.add('hide');
    }
}

function initializeVideo() {
   if (isMobile()) {
        document.getElementById('bg-video').remove(); 
        hideLoadingScreen();
        return;
    }

    const bgVideo = document.getElementById('bg-video');
    bgVideo.querySelector('source').src = getCurrentMonthVideo();
    bgVideo.load();

    const timeoutId = setTimeout(() => {
        bgVideo.pause();
        bgVideo.src = '';
        bgVideo.load();
        hideLoadingScreen();
    }, 5000);

    bgVideo.addEventListener('loadeddata', () => {
        clearTimeout(timeoutId);
        hideLoadingScreen();
    });
}

function executeScripts(container) {
    const scripts = container.querySelectorAll('script');

    scripts.forEach(oldScript => {
        const newScript = document.createElement('script');
        for (const attr of oldScript.attributes) {
            newScript.setAttribute(attr.name, attr.value);
        }
        if (oldScript.src) {
            newScript.src = oldScript.src;
        } else {
            newScript.textContent = oldScript.textContent;
        }
        oldScript.parentNode.replaceChild(newScript, oldScript);
    });
}

function loadDisqus() {
    if (document.getElementById('disqus_thread')) return;

    const disqusDiv = document.createElement('div');
    disqusDiv.id = 'disqus_thread';
    document.getElementById('disqus-container').appendChild(disqusDiv);

    window.disqus_config = function () {
        this.page.url = window.location.href;
        this.page.identifier = document.title;
    };

    const s = document.createElement('script');
    s.src = 'https://amigos-steam.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    document.body.appendChild(s);
}

async function loadContent(url, updateHash = true, anchor = '') {
    try {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`Error fetching ${url}: ${response.statusText}`);
        
        let content = await response.text();
        const contentDiv = document.getElementById('content');

        if (url.endsWith('.md')) {
            content = `<div class="markdown-content">${md.render(content)}</div>`;
        }
        
        contentDiv.innerHTML = content;
        executeScripts(contentDiv);

        currentPage = url;
        isOnMainPage = (url === DEFAULT_PAGE);

        if (updateHash) {
            const newHash = anchor ? `${url}#${anchor}` : url;
            window.history.pushState({ page: url, anchor: anchor }, '', `#${newHash}`);
        }

        if (anchor) {
            setTimeout(() => {
                const targetElement = document.getElementById(anchor);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        }
    } catch (error) {
        document.getElementById('content').innerHTML = `<p>Error Cargando: ${error.message}</p>`;
    }
}

function parseHash(hash) {
    if (!hash || hash === '#') return { page: '', anchor: '' };
    
    hash = hash.substring(1);
    
    const parts = hash.split('#');
    if (parts.length > 1) {
        return { page: parts[0], anchor: parts[1] };
    }
    
    if (hash.includes('web/')) {
        return { page: hash, anchor: '' };
    }
    
    return { page: '', anchor: hash };
}

function handleHashChange() {
    const hash = window.location.hash;
    
    if (!hash || hash === '#') {
        window.location.hash = DEFAULT_PAGE;
        return;
    }
    
    const { page, anchor } = parseHash(hash);
    
    if (!page && anchor) {
        setTimeout(() => {
            const targetElement = document.getElementById(anchor);
            if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }, 100);
        return;
    }
    
    if (page !== currentPage) {
        window.scrollTo({ top: 0, behavior: 'smooth' });
        loadContent(page, false, anchor);
    } else if (anchor) {
        setTimeout(() => {
            const targetElement = document.getElementById(anchor);
            if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }, 100);
    }
}

document.addEventListener("DOMContentLoaded", () => {
    initializeVideo();
    
    const initialHash = window.location.hash;
    const { page: startPage, anchor: startAnchor } = parseHash(initialHash);
    const finalPage = startPage || DEFAULT_PAGE;
    
    if (finalPage !== DEFAULT_PAGE) {
        window.history.replaceState({ page: DEFAULT_PAGE, isFirst: true }, '', `#${DEFAULT_PAGE}`);
        window.history.pushState({ page: finalPage, anchor: startAnchor }, '', `#${finalPage}${startAnchor ? '#' + startAnchor : ''}`);
        loadContent(finalPage, false, startAnchor);
    } else {
        loadContent(DEFAULT_PAGE, false);
    }

    loadDisqus();

    window.addEventListener('hashchange', () => {
        const hash = window.location.hash;
        const { page } = parseHash(hash);
        isOnMainPage = (!page || page === DEFAULT_PAGE);
        handleHashChange();
    });

    window.addEventListener('beforeunload', (event) => {
        if (isOnMainPage) {
            event.preventDefault();
            event.returnValue = '';
            return '';
        }
    });

    window.addEventListener('popstate', (event) => {
        if (event.state && event.state.page) {
            const anchor = event.state.anchor || '';
            isOnMainPage = (event.state.page === DEFAULT_PAGE);
            if (event.state.page !== currentPage) {
                loadContent(event.state.page, false, anchor);
            } else if (anchor) {
                const targetElement = document.getElementById(anchor);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
        } else {
            window.history.pushState({ page: DEFAULT_PAGE }, '', `#${DEFAULT_PAGE}`);
            isOnMainPage = true;
            if (currentPage !== DEFAULT_PAGE) {
                loadContent(DEFAULT_PAGE, false);
            }
        }
    });
});

document.addEventListener('click', (event) => {
    const anchor = event.target.closest('a');
    if (!anchor) return;
    if (anchor.target === "_blank") return;
    
    const href = anchor.getAttribute('href');
    
    if (href && href.startsWith('#') && !href.includes('web/')) {
        event.preventDefault();
        const targetId = href.substring(1);
        const targetElement = document.getElementById(targetId);
        
        if (targetElement) {
            const newHash = currentPage ? `${currentPage}#${targetId}` : `${DEFAULT_PAGE}#${targetId}`;
            window.history.pushState({ page: currentPage || DEFAULT_PAGE, anchor: targetId }, '', `#${newHash}`);
            targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        return;
    }
    
    const isExternalLink = anchor.href.startsWith('http://') || anchor.href.startsWith('https://');
    const isSameOrigin = anchor.href.startsWith(window.location.origin);

    if (isExternalLink && !isSameOrigin) return;

    event.preventDefault();
    
    const fullHref = anchor.href;
    let targetUrl;

    if (fullHref.includes('web/')) {
        const webIndex = fullHref.indexOf('web/');
        targetUrl = fullHref.substring(webIndex);
    } else {
        targetUrl = href;
    }

    window.scrollTo({ top: 0, behavior: 'smooth' });
    loadContent(targetUrl);
});
    </script>

    <noscript>JavaScript OFF. Se requiere JS activado</noscript>
</body>
</html>